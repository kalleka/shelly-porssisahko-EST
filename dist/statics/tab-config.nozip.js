{let l=!1,c=e=>+(""+e),s=t=>{document.querySelectorAll(".m2-c").forEach(e=>e.style.display=c(t)<0?"table-row":"none"),document.querySelectorAll(".m2-c2").forEach(e=>e.style.display=c(t)<-1?"table-row":"none")},r=(e,t)=>`<td><input type="radio" name="${e}" value="${t}"></td>`;var e=async()=>{try{if(void 0!==state&&!l&&state){var m=state.c;qs("#mode").innerHTML=MODE_STR.map((e,t)=>`<option value="${t}">${e}</option>`),qs("#mode").value=m.mode,qs("#outs").value=m.outs.join(","),qs("#inv").checked=m.inv?"checked":"",qs("#vat").value=m.vat,qs("#day").value=m.day,qs("#night").value=m.night;let t="";for(let e=0;e<24;e++)t+=`<label for="X${e}"><input type="checkbox" id="X${e}">${(""+e).padStart(2,"0")}</label> `;qs("#bk").innerHTML=t.replaceAll("X","b");let a="<tr><td>Tund</td><td>OFF</td><td>auto</td><td>ON</td></tr>";for(let e=0;e<24;e++)a+=`<tr><td>${(""+e).padStart(2,"0")}</td>${r("X"+e,0)}${r("X"+e,-1)}${r("X"+e,1)}</tr>`;qs("#fh").innerHTML=a.replaceAll("X","f");for(let e=0;e<24;e++)qs("#b"+e).checked=(m.bk&1<<e)==1<<e,((e,t)=>{document.querySelectorAll(`[name=${e}]`).forEach(e=>e.checked=e.value==t)})("f"+e,(m.fh&1<<e)==1<<e?(m.fhCmd&1<<e)==1<<e?1:0:-1);qs("#min").value=m.min,qs("#oc").value=m.oc,qs("#err").checked=m.err?"checked":"",qs("#m0-cmd").checked=m.m0.cmd?"checked":"",qs("#m1-lim").value=m.m1.lim,qs("#m2-per").value=m.m2.per,qs("#m2-cnt").value=m.m2.cnt,qs("#m2-sq").checked=m.m2.sq?"checked":"",qs("#m2-m").value=m.m2.m,qs("#m2-lim").value=m.m2.lim,qs("#m2-ps").value=(""+m.m2.ps).padStart(2,"0"),qs("#m2-pe").value=(""+m.m2.pe).padStart(2,"0"),qs("#m2-ps2").value=(""+m.m2.ps2).padStart(2,"0"),qs("#m2-pe2").value=(""+m.m2.pe2).padStart(2,"0"),qs("#m2-cnt2").value=m.m2.cnt2,s(m.m2.per),l=!0}}catch(e){console.error(e)}};e(),CBS.push(e),qs("#save").addEventListener("click",async e=>{e.preventDefault();e=(e,t,a)=>Math.min(a,Math.max(e,t));try{var t=state.c,a=e=>"avg"==qs(e).value?"avg":c(qs(e).value);t.mode=c(qs("#mode").value),t.outs=qs("#outs").value.split(",").map(e=>c(e)),t.inv=qs("#inv").checked?1:0,t.vat=c(qs("#vat").value),t.day=c(qs("#day").value),t.night=c(qs("#night").value),t.bk=0,t.fh=0;for(let e=t.fhCmd=0;e<24;e++){qs("#b"+e).checked&&(t.bk=t.bk|1<<e);var m=qs(`[name=f${e}]:checked`).value;-1!=m&&(t.fh=t.fh|1<<e,t.fhCmd=t.fhCmd|m<<e)}t.err=qs("#err").checked?1:0,t.min=c(qs("#min").value),t.oc=c(qs("#oc").value),t.min=e(0,t.min,60),t.m0.cmd=qs("#m0-cmd").checked?1:0,t.m1.lim=a("#m1-lim"),t.m2.per=c(qs("#m2-per").value),t.m2.cnt=c(qs("#m2-cnt").value),t.m2.sq=qs("#m2-sq").checked?1:0,t.m2.m=a("#m2-m"),t.m2.lim=a("#m2-lim"),t.m2.ps=e(0,c(qs("#m2-ps").value),23),t.m2.pe=e(t.m2.ps,c(qs("#m2-pe").value),24),t.m2.ps2=e(0,c(qs("#m2-ps2").value),23),t.m2.pe2=e(t.m2.ps2,c(qs("#m2-pe2").value),24),t.m2.cnt2=c(qs("#m2-cnt2").value),t.m2.cnt=e(0,t.m2.cnt,0<t.m2.per?t.m2.per:t.m2.pe-t.m2.ps),t.m2.cnt2=e(0,t.m2.cnt2,t.m2.pe2-t.m2.ps2);var s=await getData(URL+'/rpc/KVS.Set?key="porssi-config"&value='+JSON.stringify(t));200==s.code?getData(URLS+"?r=r").then(e=>{alert("Salvestatud!"),l=!1}).catch(e=>{alert(`Viga: ${e})`)}):alert(`Viga: ${s.txt})`)}catch(e){alert("Viga: "+e.message)}}),qs("#force").addEventListener("click",async()=>{var e,t=prompt("Käsitsi lülituse kestus tundides? (0 = tühista praegune)");null!=t&&(e=0<(t=+(""+t))?parseInt(prompt("Käsitsi lülitus SISSE (1) või VÄLJA (0)?","1")):0,isNaN(e)||(t=await getData(`${URLS}?r=f&ts=${0<t?Math.floor(Date.now()/1e3+60*t*60):0}&c=`+e),alert(204==t.code?"OK!":"Viga: "+t.txt)))}),qs("#m2-per").addEventListener("change",e=>s(e.target.value))}